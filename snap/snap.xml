<tool id="snap" name="SNAP" version="0.15">
	<description>
		SNAP - Scalable Nucleotide Alignment Program
	</description>
	<requirements>
		<requirement type="package" version="0.15">snap</requirement>
		<requirement type="package" version="0.1.19">samtools</requirement>>
	</requirements>
	<command>
		snap paired ${reference.fields.path} $pair_one $pair_two -so -sam - | samtools view 
		#if $filter
			-h
			-S
			-b
			-q $filter.mapq
			#set $flags = 0
			#for $item in $filter.flags
				#set $flags += $item.value
			#end for
			-F $flags
		#end if
		> $output;
	</command>
	<inputs>
		<param type="data" format="fastq" name="pair_one" label="Fastq Pair One"/>
		<param type="data" format="fastq" name="pair_two" label="Fastq Pair Two"/>
		<param name="index" type="select" label="SNAP Reference File">
			<options from_data_table="snap_reference_file"/> 
		</param>
		<conditional name="filter">
			<param type="select" name="additionalOpt" label="Filter Output Alignment">
				<option value="yes">Yes</option>
				<option value="no" selected="True">No</option>
			</param>
			<when value="yes">
				<param type="int" value="30" name="mapq" label="Minimum Mapping Quality">
				<param type="select" multiple="true" display="checkboxes" name="flags" label="Filter reads containing the Following Flags">
					<option value="1">read paired</option>
					<option value="2">read mapped in proper pair</option>
					<option value="4" selected="true">read unmapped</option>
					<option value="8">mate unmapped</option>
					<option value="16">read reverse strand</option>
					<option value="32">mate reverse strand</option>
					<option value="64">first in pair</option>
					<option value="128">second in pair</option>
					<option value="256" selected="true">not primary alignment</option>
					<option value="512">read fails platform/vendor quality checks</option>
					<option value="1024" selected="true">read is PCR or optical duplicate</option>	
					<option value="2048">supplementary alignment</option>						
				</param>
			</when>
		</conditional>
	</inputs>
	<outputs>
		<data format="bam" name="output">
	</outputs>
</tool>