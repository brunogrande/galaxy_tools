<tool id="make_parallel" name="Make Parallel" version="1.0.0">
	<description> Creates Interval files used to parallelize certain Galaxy Tools </description>
	<requirements>
		<requirement type="package" version="0.8.1">pysam</requirement>
		<requirement type="package" version="1.0.0">make_parallel</requirement>
		<requirement type="set_environment">MAKE_PARALLEL_DIR</requirement>
	</requirements>
	<command>
	<![CDATA[	
		
		#if $modes.mode == "default"
			python \$MAKE_PARALLEL_DIR/make_interval.py
			--mode $modes.intervals.interval
			#if $modes.intervals.interval == 'by_chunk'
				--chunk_size $modes.intervals.chunk_size
			#end if		
			--input $input
			--output output.txt
			--chromosome
			--start_position
			--end_position;

		#elif $modes.mode == "strelka"
			python \$MAKE_PARALLEL_DIR/make_interval.py --mode by_rname --input $input --output output.txt --chromosome;


		#end if
		
		tmp=0;
		mkdir outputs;
		for i in \$( cat output.txt );
		do
			tmp=\$((\$tmp + 1));
			echo \$i > ./outputs/samp\${tmp}.bed;
		done

	]]>
	</command>
	<inputs>
		<conditional name="modes">
			
			<param type="select" name="mode" label="Pick Mode for Parallelism">
				<option value="default">Default</option>
				<option value="strelka">Strelka</option>
				<!-- FUTURE MODES -->
			</param>

			<!-- DEFAULT SETTINGS -->
			<when value="default">
				<param type="data" format="bam" name="input" label="BAM Alignment File" help="Information is pulled from the header, ensure consistent across BAMs"/>
		   		<conditional name="intervals">
		      	<param type="select" name="interval" label="Interval Mode">
    		    	<option value="by_rname">Split into Chromosomes</option>
       				<option value="by_chunk" selected="true">Split into Chunks</option>
      			</param>
	      		<when value="by_chunk">
	        		<param type="integer" name="chunk_size" value="50000000" label="Number of Bases to include in each Interval"/>
	      		</when>
    			</conditional>
			</when>

			<!-- STRELKA SETTINGS -->
			<when value="strelka">
				<param type="data" format="bam" name="input" label="BAM Alignment File" help="Information is pulled from the header, ensure consistent across BAMs"/>
			</when>
						
			<!-- FUTURE MODE SETTINGS -->
		</conditional>
	</inputs>
	<outputs>
		<collection name="list_output" type="list" description="Interval Files">
			<discover_datasets pattern="__name_and_ext__" directory="outputs"/>
		</collection>
	</outputs>
</tool>
