<tool id="museq" name="MutationSeq" version="4.2.1">
	<description>
		Feature Based Classifier for Somatic Mutation Detection
	</description>
	<requirements>
		<requirement type="package" version="0.14.1">scikit_learn</requirement>
		<requirement type="package" version="2.4.1">ruffus</requirement>
		<requirement type="package" version="4.2.1">museq</requirement>
		<requirement type="set_environment" version="4.2.1">museq</requirement>
		<requirement type="package" version="1.55.0">boost</requirement>
	</requirements>
	<parallelism method="multi" split_inputs="interval_file" split_mode="to_size" split_size="1" shared_inputs="normal,tumour" merge_outputs="output"></parallelism>
	<command>

		<!-- Linking BAM Indexs to current working directory -->
		ln -s $normal normal.bam;
		ln -s $normal.metadata.bam_index normal.bam.bai;
		ln -s $tumour tumour.bam;
		ln -s $tumour.metadata.bam_index tumour.bam.bai;

		<!-- Run Mutation Seq -->
		python \$MUSEQ_DIR/classify.py

		normal:normal.bam
		tumour:tumour.bam
		reference:${reference.fields.path}

		#if $model.value == "standard"
			model:\$MUSEQ_DIR/model_v4.1.2.npz
		#elif $model.value == "standard_single"
			model:\$MUSEQ_DIR/model_single_v4.0.2.npz
			--single
		#elif $model.value == "solid"
			model:\$MUSEQ_DIR/model_solid_v4.1.0.npz
		#elif $model.value == "deepseq"
			model:\$MUSEQ_DIR/model_deep_v0.2.npz
			--deep
		#elif $model.value == "deepseq_single"
			model:\$MUSEQ_DIR/model_deep_single_v0.2.npz
			--single
			--deep
		#end if

		-o $output
		-c \$MUSEQ_DIR/metadata.config

		#if $filter.value == "all"
			--all
		#elif $filter.value == "no_filter"
			--no_filter
		#end if

		--coverage $coverage
		--indl_threshold $indl_threshold
		--mapq_threshold $mapq_threshold
		--baseq_threshold $baseq_threshold
		--threshold $threshold

		#if $interval_file
			if [ \$(wc -l $interval_file) -eq 1 ]; then --interval \$(cat $interval_file | cut -f1):\$(cat $interval_file | cut -f2)-\$(cat $interval_file | cut -f3); fi;
		#elif $interval
			--interval $interval
		#end if

	</command>
	<inputs>
		<param type="data" format="bam" name="normal" label="Normal Alignment BAM"/>
		<param type="data" format="bam" name="tumour" label="Tumour Alignment BAM"/>
		<param name="reference" type="select" label="Reference File">
			<options from_data_table="all_fasta"/> 
		</param>
		<param type="data" format="txt" name="interval_file" optional="True" label="Interval File" help="Used when parallelizing MutationSeq"/>
		<param type="text" name="interval" optional="True" label="Interval" help="e.g.    chr1:0-100000"/>
		<param type="select" name="model" label="Model">
			<option value="standard" selected="true">Matched Sample Illumina Model</option>
			<option value="standard_single">Single Sample Illumina Model</option>
			<option value="solid">Matched Sample Solid Model</option>
			<option value="deepseq">Matched Sample Deepseq Model</option>
			<option value="deepseq_single">Single Sample Deepseq Model</option>
		</param>
		<param type="select" name="filter" label="Filter Method">
			<option value="standard" selected="true">Print Probablistic Positions</option>
			<option value="all">Print Positions Regardless of Classified Probabilitly</option>
			<option value="no_filter">Print Positions Regardless of Initial Criteira</option>
		</param>
		<param type="integer" value="0" name="coverage" label="Specify min depth (coverage) to be considered"/>
		<param type="float" value="0" name="indl_threshold" min="0" max="1" label="Threshold for INDL Flag" help="variant reads with indel / number of variant reads"/>
		<param type="integer" value="0" name="mapq_threshold" min="0" max="255" label="Threshold for Mapping Quality"/>
		<param type="integer" value="0" name="baseq_threshold" min="0" max="255" label="Treshold for Base Quality"/>
		<param type="integer" value="0" name="threshold" min="0" max="100" label="Threshold for Positive Calls"/>
		<param type="integer" value="0" name="normal_variant" min="0" max="100" label="Max Variant Percentage in Normal"/>
		<param type="integer" value="0" name="tumour_variant" min="0" max="100" label="Max Variant Percentage in Tumour"/>
	</inputs>
	<outputs>
		<data format="bam" name="output"/>
	</outputs>
</tool>